# API сервиса почты

Предложенное API предоставляет доступ к обычным функциям e-mail.

Для API был выбран REST-подход, потому что он основан на работе с ресурсами и связей между ресурсами с помощью ссылок, что хорошо подходит для сценариев работы с почтой, в то время как модель объектов и методов, на которой основан RPC, имеет преимущества лишь в методе посылки сообщения (так как это есть выполнение некоторой операции удаленно), но в то же время эта модель уступает REST в других сценариях (создание меток, просмотр тредов и т.д.), которые важны для предоставления удобного интерфейса и могут быть выражены в CRUD модели.

Опишем ресурсы, к которым API предоставляет доступ.

### Сообщения

Все сообщения предполагаются неизменяемыми, их можно создавать и удалять.

```json
{
    "id": string,
    "thread": "/userId/threads/{thread_id}",
    "payload": {
        "body": string,
        "to": string,
        "cc": string,
        "theme": string
    }
}
```

Доступные методы:

Запрос | Описание
 --- | ---
DELETE  /userId/messages/id | Удалить сообщение
GET  /userId/messages/id | Получить сообщение
GET /userId/messages | Получить все сообщения пользователя
POST /userId/messages/send | Отправить сообещения пользователям, указанным в ```headers['To']``` (получатель) и ```headers['Cc']``` (копия) поля ```payload``` сообщения

### Треды
Треды являются последовательностью сообщений, представляющими беседу. Треды нельзя создавать, их можно только удалять.

Описание
```json
{
    "id": string,
    "messages": [
        {
            "link": "/userId/messages/{message_id}",
            "payload": {
                "body": string,
                "to": string,
                "cc": string,
                "theme": string
            }
        }
    ]
}
```

В списке ```messages``` лежат описания сообщений выше.

Доступные методы:

Запрос | Описание
------------ | -------------
GET  /userId/threads/id | Получить тред
GET  /userId/threads | Получить все треды пользователя
DELETE  /userId/threads/id | Удалить тред

Как видим, протокол общения является stateless. Отметим, что описания наших ресурсов не удовлетворяют REST в том плане, что они не предоставляют "честного" гипермедиа, так как, к примеру в описании сообщения содержится лишь id треда, а не ссылка на него, но этим было решено пожертвовать для простоты, и вшить знание, как по id сущности получить адрес ее ресурса, в клиента, чтобы соблюсти принципы HATEOAS.
